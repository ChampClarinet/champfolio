#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

echo "ğŸ” Checking version before pushing to main..."

branch=$(git rev-parse --abbrev-ref HEAD)

if [ "$branch" != "main" ]; then
  echo "ğŸŒ¿ Not pushing to main, skipping version check."
  exit 0
fi

# à¸”à¸¶à¸‡ version à¸ˆà¸²à¸ main à¸šà¸™ remote
main_version=$(git show origin/main:package.json | grep '"version"' | head -1 | sed -E 's/.*"version": *"(.*)".*/\1/')
# à¸”à¸¶à¸‡ version à¸›à¸±à¸ˆà¸ˆà¸¸à¸šà¸±à¸™à¹ƒà¸™ local
current_version=$(grep '"version"' package.json | head -1 | sed -E 's/.*"version": *"(.*)".*/\1/')

if [ "$main_version" = "$current_version" ]; then
  echo "âŒ package.json version is still $current_version â€” must bump before pushing to main!"
  exit 1
fi

echo "âœ… Version updated: $main_version â†’ $current_version"
